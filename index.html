<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Game UI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using a custom font for a better look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Prevent scrolling and bouncing on mobile */
            overscroll-behavior-y: contain;
        }

        /* Style for a standard winning combination */
        .winner div, .glow {
            box-shadow: 0 0 25px 5px gold;
            border-color: gold !important;
        }
        
        /* New style for the locked item slot */
        .locked-slot {
            border-color: #FBBF24 !important; /* Tailwind yellow-400, !important to override Tailwind default */
            box-shadow: 0 0 10px #FBBF24;
        }

        /* Smooth transition for health/armor bars */
        .health-bar, .armor-bar {
            transition: width 0.3s ease-in-out;
        }

        /* Transition for characters moving/disappearing */
        .character-container {
            transition: transform 0.2s ease-in-out, opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-black flex items-center justify-center min-h-screen">

    <!-- This container is now the full screen on mobile, and a framed portrait view on desktop -->
    <div id="game-ui" class="w-screen h-screen overflow-hidden relative md:max-w-sm md:h-[800px] md:rounded-2xl md:shadow-2xl border-2 border-teal-400">

        <!-- Main flex container for the game sections -->
        <div class="flex flex-col h-full w-full">

            <!-- 1. Unified Top Section: Status Bar & Meters -->
            <header class="flex-shrink-0 bg-gradient-to-br from-black to-blue-900 px-4 py-3 flex flex-col gap-3 text-white">
                <!-- Resource Counters -->
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-1">
                        <span class="text-2xl">ğŸª™</span>
                        <span id="gold-count" class="font-bold text-base sm:text-lg">125</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-2xl">ğŸŒ¿</span>
                        <span class="font-bold text-base sm:text-lg">99</span>
                    </div>
                     <div class="flex items-center gap-1">
                        <span class="text-2xl">ğŸ”®</span>
                        <span class="font-bold text-base sm:text-lg">42</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-2xl">âœ¨</span>
                        <span class="font-bold text-base sm:text-lg text-yellow-300">03</span>
                    </div>
                </div>
                <!-- Player Meters -->
                <div class="space-y-2">
                    <div class="flex items-center">
                        <span class="text-lg mr-2">â¤ï¸</span>
                        <div class="w-full bg-black/30 rounded-full h-2">
                            <div id="player-health-bar" class="bg-red-500 h-2 rounded-full health-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ’œ</span>
                        <div class="w-full bg-black/30 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 2. Main Game View -->
            <main class="flex-1 flex items-center justify-between p-4 bg-gradient-to-br from-black to-green-900">
                <!-- Character on the left -->
                <div id="player-character" class="flex flex-col items-center character-container">
                    <span class="text-8xl">ğŸ§</span>
                    <div class="w-24 h-2 bg-black/30 rounded-full mt-4 border-2 border-black/30 overflow-hidden">
                        <div id="player-armor-bar" class="bg-blue-500 h-full rounded-full armor-bar" style="width: 100%;"></div>
                    </div>
                </div>
                <!-- Enemies on the right -->
                <div class="flex flex-col gap-8">
                    <div id="enemy-1" class="flex flex-col items-center character-container">
                        <span class="text-6xl enemy-emoji">ğŸº</span>
                        <div class="w-16 h-2 bg-black/30 rounded-full mt-2 border-2 border-black/30 overflow-hidden">
                           <div id="enemy-1-hp" class="bg-red-500 h-full rounded-full health-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div id="enemy-2" class="flex flex-col items-center character-container">
                        <span class="text-6xl enemy-emoji">ğŸŠ</span>
                         <div class="w-16 h-2 bg-black/30 rounded-full mt-2 border-2 border-black/30 overflow-hidden">
                           <div id="enemy-2-hp" class="bg-red-500 h-full rounded-full health-bar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- 3. Slot Machine and Upgrades View -->
            <section class="flex-1 bg-gradient-to-br from-black to-pink-900 p-4 flex flex-col items-center justify-start pt-6 backdrop-blur-sm space-y-4">
                <div class="relative w-full max-w-xs flex justify-center items-center h-16">
                    <div id="spins-remaining-container" class="absolute left-0 w-16 h-16 text-white opacity-0 transition-opacity duration-300 flex items-center justify-center">
                        <div id="spins-remaining-count" class="font-bold text-4xl leading-none">5</div>
                    </div>
                    <div id="slot-machine-container" class="flex gap-2 sm:gap-3 transition-all duration-300 rounded-lg">
                        <div id="reel1" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span class="transition-opacity duration-200 ease-in-out"></span></div>
                        <div id="reel2" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span class="transition-opacity duration-200 ease-in-out"></span></div>
                        <div id="reel3" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span class="transition-opacity duration-200 ease-in-out"></span></div>
                    </div>
                </div>
                 <!-- Upgrade List -->
                <div id="upgrade-list" class="w-full max-w-xs text-gray-300 text-xs grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="flex items-center"><span class="text-base mr-2">âš¡ï¸</span><span>Upgrade 1</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ€</span><span>Upgrade 2</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ’</span><span>Upgrade 3</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ’°</span><span>Upgrade 4</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ”„</span><span>Upgrade 5</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ‰</span><span>Upgrade 6</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">ğŸ“ˆ</span><span>Upgrade 7</span></div>
                    <div class="flex items-center"><span class="text-base mr-2">â¤ï¸</span><span>Upgrade 8</span></div>
                </div>
            </section>

            <!-- 4. Navigation -->
            <footer class="flex-shrink-0 h-24 bg-gradient-to-br from-black to-purple-900 p-3 flex justify-around items-center">
                <a href="#" class="flex-1 text-gray-400 hover:text-white transition-colors flex flex-col items-center justify-center">
                    <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center"></div>
                </a>
                <a href="#" id="spin-button" class="flex-1 text-white flex flex-col items-center cursor-pointer">
                    <div class="w-20 h-20 rounded-full bg-purple-600 flex items-center justify-center transition-all duration-100 ease-in-out active:scale-90 active:brightness-75">
                        <span class="text-5xl font-bold">5</span>
                    </div>
                </a>
                <a href="#" class="flex-1 text-gray-400 hover:text-white transition-colors flex flex-col items-center justify-center">
                    <div class="w-10 h-10 bg-teal-500 rounded-full flex items-center justify-center">
                        <span class="text-xl">âœ¨</span>
                    </div>
                </a>
            </footer>

            <!-- 5. Item Slots -->
            <section class="flex-shrink-0 h-20 bg-gradient-to-br from-black to-blue-900 p-3 grid grid-cols-3 gap-3 items-center">
                <div id="item-slot-container-1" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">ğŸŸ¡ 3</span>
                    <span id="item-slot-1" class="text-3xl opacity-80"></span>
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">+1</span>
                </div>
                <div id="item-slot-container-2" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">ğŸŸ¡ 3</span>
                    <span id="item-slot-2" class="text-3xl opacity-80"></span>
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">+1</span>
                </div>
                <div id="item-slot-container-3" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">ğŸŸ¡ 3</span>
                    <span id="item-slot-3" class="text-3xl opacity-80"></span>
                    <span class="item-stat text-sm font-bold opacity-80 transition-opacity opacity-0">+1</span>
                </div>
            </section>
        </div>

        <!-- Victory Message Overlay -->
        <div id="victory-message" class="absolute inset-0 bg-black/70 flex-col items-center justify-center text-white text-center text-4xl font-bold z-50 hidden transition-opacity duration-300">
            <p>Battle Won!</p>
            <p id="battle-won-details" class="text-2xl mt-2 text-yellow-400">+10 Gold</p>
        </div>

        <!-- Shop Modal -->
        <div id="shop-modal" class="absolute inset-0 bg-black/80 flex-col items-center justify-center text-white z-50 hidden">
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl border border-yellow-400 w-11/12 max-w-md text-center">
                <h2 class="text-3xl font-bold mb-4 text-yellow-300">ğŸª Welcome! ğŸª</h2>
                <p class="mb-6">The shop is currently under construction. Come back later!</p>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <!-- Mock-up items -->
                    <div class="bg-black/50 p-4 rounded-lg border border-gray-600">Health Potion â¤ï¸</div>
                    <div class="bg-black/50 p-4 rounded-lg border border-gray-600">Armor Plate ğŸ›¡ï¸</div>
                    <div class="bg-black/50 p-4 rounded-lg border border-gray-600">Power Up âš”ï¸</div>
                    <div class="bg-black/50 p-4 rounded-lg border border-gray-600">Extra Spin âœ¨</div>
                </div>
                <button id="close-shop-button" class="bg-purple-600 px-6 py-2 rounded-lg font-bold transition-transform active:scale-95">Close</button>
            </div>
        </div>

        <!-- Urn Modal -->
        <div id="urn-modal" class="absolute inset-0 bg-black/80 flex-col items-center justify-center text-white z-50 hidden">
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl border border-amber-400 w-11/12 max-w-md text-center">
                <h2 class="text-3xl font-bold mb-4 text-amber-300">ğŸº An Ancient Urn ğŸº</h2>
                <p class="mb-6">You found a mysterious urn. What could be inside?</p>
                <div class="text-5xl mb-6">? ? ?</div>
                <button id="close-urn-button" class="bg-amber-600 px-6 py-2 rounded-lg font-bold transition-transform active:scale-95">Leave It</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const spinButton = document.getElementById('spin-button');
        const reelElements = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
        const itemSlotSpans = [document.getElementById('item-slot-1'), document.getElementById('item-slot-2'), document.getElementById('item-slot-3')];
        const itemSlotContainers = [document.getElementById('item-slot-container-1'), document.getElementById('item-slot-container-2'), document.getElementById('item-slot-container-3')];
        const slotMachineContainer = document.getElementById('slot-machine-container');
        const goldCountElement = document.getElementById('gold-count');
        const spinsRemainingContainer = document.getElementById('spins-remaining-container');
        const spinsRemainingCount = document.getElementById('spins-remaining-count');
        const victoryMessageElement = document.getElementById('victory-message');
        const battleWonDetails = document.getElementById('battle-won-details');
        const shopModal = document.getElementById('shop-modal');
        const closeShopButton = document.getElementById('close-shop-button');
        const urnModal = document.getElementById('urn-modal');
        const closeUrnButton = document.getElementById('close-urn-button');

        // Game Assets
        const food = ['ğŸ', 'ğŸ—', 'ğŸ‹'];
        const weapons = ['ğŸ—¡ï¸', 'ğŸ¹', 'ğŸª“'];
        const clothing = ['ğŸ‘¢', 'ğŸ§¥', 'ğŸ§¤'];
        const items = ['ğŸ—ï¸', 'ğŸ“œ', 'ğŸªˆ'];
        const enemyEmojis = ['ğŸº', 'ğŸŠ', 'ğŸ‰', 'ğŸ‘»', 'ğŸ™', 'ğŸ•·ï¸', 'ğŸ¦‚', 'ğŸ¦‡', 'ğŸ‘¹', 'ğŸ'];
        const emojis = [...food, ...weapons, ...clothing, ...items, 'ğŸª', 'ğŸº'];


        // Game State
        let isSpinning = false;
        let isPaused = false;
        let lockedSlotIndex = -1; // -1 indicates no slot is locked initially
        let gold = 125;
        const SPIN_COST_SEQUENCE = 5;
        let battleCount = 0;
        let hasShopAppearedThisTurn = false;
        let hasUrnAppearedThisTurn = false;

        // Battle State
        const BASE_ENEMY_HP = 5;
        const BASE_ENEMY_DAMAGE = 1;

        let player = {
            hp: 10,
            maxHp: 10,
            armor: 5,
            maxArmor: 5,
            damage: 3,
            element: document.getElementById('player-character'),
            hpBar: document.getElementById('player-health-bar'),
            armorBar: document.getElementById('player-armor-bar')
        };

        let enemies = [
            {
                id: 1,
                hp: 5,
                maxHp: 5,
                damage: 1,
                isAlive: true,
                element: document.getElementById('enemy-1'),
                hpBar: document.getElementById('enemy-1-hp')
            },
            {
                id: 2,
                hp: 5,
                maxHp: 5,
                damage: 1,
                isAlive: true,
                element: document.getElementById('enemy-2'),
                hpBar: document.getElementById('enemy-2-hp')
            }
        ];

        // --- UI Update Functions ---
        function updateAllUI() {
            player.hpBar.style.width = `${(player.hp / player.maxHp) * 100}%`;
            player.armorBar.style.width = `${(player.armor / player.maxArmor) * 100}%`;
            enemies.forEach(enemy => {
                 enemy.hpBar.style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;
            });
            goldCountElement.textContent = gold;
        }

        function updateItemSlotVisuals() {
            itemSlotContainers.forEach((container, index) => {
                const itemSymbol = itemSlotSpans[index].textContent.trim();
                const statElements = container.querySelectorAll('.item-stat');
                if (itemSymbol === '') {
                    statElements.forEach(el => el.classList.add('opacity-0'));
                } else {
                    statElements.forEach(el => el.classList.remove('opacity-0'));
                }
            });
        }

        async function showVictoryMessage() {
            return new Promise(resolve => {
                battleWonDetails.textContent = `+10 Gold | Wave ${battleCount + 1} Cleared!`;
                victoryMessageElement.classList.remove('hidden', 'opacity-0');
                victoryMessageElement.classList.add('flex');
                setTimeout(() => {
                    victoryMessageElement.classList.add('opacity-0');
                     setTimeout(() => {
                        victoryMessageElement.classList.add('hidden');
                        victoryMessageElement.classList.remove('flex', 'opacity-0'); // Reset for next time
                        resolve();
                    }, 300);
                }, 1500);
            });
        }
        
        function setupNextBattle() {
            const newHp = BASE_ENEMY_HP + battleCount;
            const newDamage = BASE_ENEMY_DAMAGE + Math.floor(battleCount / 2);

            const shuffledEnemies = [...enemyEmojis].sort(() => 0.5 - Math.random());

            enemies.forEach((enemy, index) => {
                enemy.maxHp = newHp;
                enemy.hp = newHp;
                enemy.damage = newDamage;
                enemy.isAlive = true;
                enemy.element.classList.remove('opacity-0');
                enemy.element.querySelector('.enemy-emoji').textContent = shuffledEnemies[index];
            });
            updateAllUI();
        }
        
        function setLockedSlot(index) {
            if (isSpinning || itemSlotSpans[index].textContent.trim() === '') return;

            // If clicking the currently locked slot, unlock it
            if (lockedSlotIndex === index) {
                itemSlotContainers[index].classList.remove('locked-slot');
                lockedSlotIndex = -1;
                return;
            }

            // Otherwise, set the new locked slot
            itemSlotContainers.forEach(container => container.classList.remove('locked-slot'));
            if (itemSlotContainers[index]) {
                itemSlotContainers[index].classList.add('locked-slot');
                lockedSlotIndex = index;
            }
        }

        // --- Spin & Slot Machine Logic ---
        async function runSingleSpinAnimation() {
             return new Promise(async (resolve) => {
                slotMachineContainer.classList.remove('winner');
                reelElements.forEach(reel => reel.classList.remove('glow'));
                const spans = reelElements.map(reel => reel.querySelector('span'));
                spans.forEach(span => { span.style.opacity = '0'; });
                await new Promise(res => setTimeout(res, 50));
                
                const reelValues = [];
                for (const span of spans) {
                    const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    reelValues.push(randomEmoji);
                    span.textContent = randomEmoji;
                    span.style.opacity = '1';
                    await new Promise(res => setTimeout(res, 150));
                }

                checkWin(reelValues);
                
                let openedModal = false;
                if (reelValues.includes('ğŸª') && !hasShopAppearedThisTurn) {
                    reelValues.forEach((value, index) => {
                        if (value === 'ğŸª') reelElements[index].classList.add('glow');
                    });
                    await new Promise(res => setTimeout(res, 600)); // Wait for animation to be visible
                    isPaused = true;
                    hasShopAppearedThisTurn = true;
                    shopModal.classList.remove('hidden');
                    shopModal.classList.add('flex');
                    openedModal = true;
                } 
                
                if (reelValues.includes('ğŸº') && !hasUrnAppearedThisTurn && !openedModal) {
                     reelValues.forEach((value, index) => {
                        if (value === 'ğŸº') reelElements[index].classList.add('glow');
                    });
                    await new Promise(res => setTimeout(res, 600)); // Wait for animation
                    isPaused = true;
                    hasUrnAppearedThisTurn = true;
                    urnModal.classList.remove('hidden');
                    urnModal.classList.add('flex');
                }

                await new Promise(res => setTimeout(res, 100));
                resolve();
            });
        }

        async function startFiveSpins() {
            if (isSpinning) return;
            if (gold < SPIN_COST_SEQUENCE) {
                console.log("Not enough gold for 5 spins!");
                return;
            }

            hasShopAppearedThisTurn = false;
            hasUrnAppearedThisTurn = false;
            
            isSpinning = true;
            spinsRemainingContainer.classList.remove('opacity-0');
            
            for (let i = SPIN_COST_SEQUENCE; i > 0; i--) {
                const livingEnemies = enemies.filter(e => e.isAlive);
                if (gold <= 0 || livingEnemies.length === 0) break;

                gold--;
                updateAllUI();
                spinsRemainingCount.textContent = i;
                
                await runSingleSpinAnimation();

                // Pause loop if a modal is open
                while (isPaused) {
                    await new Promise(resolve => setTimeout(resolve, 100)); 
                }
                
                await new Promise(res => setTimeout(res, 200));
                
                await performBattleTurn();
                await new Promise(res => setTimeout(res, 500)); 
            }
            
            player.armor = player.maxArmor;
            
            // Check for victory
            if (enemies.every(e => !e.isAlive)) {
                gold += 10;
                await showVictoryMessage();
                battleCount++; // Increment battle count for the next wave
                setupNextBattle();
            }

            updateAllUI();
            spinsRemainingContainer.classList.add('opacity-0');
            isSpinning = false;
        }

        function checkWin(reelValues) {
            if (reelValues[0] === reelValues[1] && reelValues[1] === reelValues[2]) {
                slotMachineContainer.classList.add('winner');
            }

            for (const category of [items, clothing, food, weapons]) {
                if (reelValues.every(emoji => category.includes(emoji))) {
                    for (let i = 0; i < itemSlotSpans.length; i++) {
                        if (i !== lockedSlotIndex) {
                            itemSlotSpans[i].textContent = reelValues[i];
                        }
                    }
                    slotMachineContainer.classList.add('winner');
                    updateItemSlotVisuals(); // Update visuals after assigning new items
                    break;
                }
            }
        }

        // --- Battle Logic ---
        async function performBattleTurn() {
            const livingEnemies = enemies.filter(e => e.isAlive);
            if (livingEnemies.length === 0) return;

            const target = livingEnemies[Math.floor(Math.random() * livingEnemies.length)];

            // Player attacks enemy
            player.element.style.transform = 'translateX(10px)';
            await new Promise(res => setTimeout(res, 150));
            target.hp -= player.damage;
            target.element.classList.add('opacity-50');
            await new Promise(res => setTimeout(res, 150));
            target.element.classList.remove('opacity-50');
            player.element.style.transform = 'translateX(0)';
            
            if (target.hp <= 0) {
                target.hp = 0;
                target.isAlive = false;
                target.element.classList.add('opacity-0');
            }
            updateAllUI();
            
            if (!target.isAlive) return;
            await new Promise(res => setTimeout(res, 200));

            // Enemy retaliates
            target.element.style.transform = 'translateX(-10px)';
            await new Promise(res => setTimeout(res, 150));

            let damageToPlayer = target.damage;
            const armorDamage = Math.min(player.armor, damageToPlayer);
            player.armor -= armorDamage;
            damageToPlayer -= armorDamage;
            player.hp -= damageToPlayer;
            if (player.hp < 0) player.hp = 0;

            player.element.classList.add('opacity-50');
            await new Promise(res => setTimeout(res, 150));
            player.element.classList.remove('opacity-50');
            target.element.style.transform = 'translateX(0)';

            updateAllUI();
        }

        // --- Event Listeners & Initialization ---
        spinButton.addEventListener('click', startFiveSpins);
        
        itemSlotContainers.forEach((container, index) => {
            container.addEventListener('click', () => setLockedSlot(index));
        });
        
        closeShopButton.addEventListener('click', () => {
            shopModal.classList.add('hidden');
            shopModal.classList.remove('flex');
            isPaused = false;
        });

        closeUrnButton.addEventListener('click', () => {
            urnModal.classList.add('hidden');
            urnModal.classList.remove('flex');
            isPaused = false;
        });

        // Initialize the game state on load
        function initializeGame() {
            setupNextBattle();
            // Start with empty slots and reels
            itemSlotSpans.forEach(span => span.textContent = '');
            reelElements.forEach(reel => reel.querySelector('span').textContent = '');
            itemSlotContainers.forEach(container => container.classList.remove('locked-slot'));
            lockedSlotIndex = -1;
            updateItemSlotVisuals();
        }

        initializeGame();

    </script>
</body>
</html>

