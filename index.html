<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Game UI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using a custom font for a better look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Prevent scrolling and bouncing on mobile */
            overscroll-behavior-y: contain;
        }

        /* Keyframes for the symbol fade-in effect */
        @keyframes symbolFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* A class to apply the animation to the symbol itself */
        .symbol-animate {
            animation: symbolFadeIn 0.3s ease-out forwards;
        }

        /* Style for a standard winning combination */
        .winner div {
            box-shadow: 0 0 25px 5px gold;
            border-color: gold;
        }

        /* Keyframes for the new category win pulse effect */
        @keyframes pulseGlow {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(192, 132, 252, 0);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 30px 10px rgba(192, 132, 252, 0.7); /* A vibrant purple glow */
            }
        }

        /* A class to apply the category win animation */
        .category-win-animation {
            animation: pulseGlow 2s ease-in-out;
        }
        
        /* New style for the locked item slot */
        .locked-slot {
            border-color: #FBBF24 !important; /* Tailwind yellow-400, !important to override Tailwind default */
            box-shadow: 0 0 10px #FBBF24;
        }
    </style>
</head>
<body class="bg-black flex items-center justify-center min-h-screen">

    <!-- This container is now the full screen on mobile, and a framed portrait view on desktop -->
    <div id="game-ui" class="w-screen h-screen overflow-hidden relative md:max-w-sm md:h-[800px] md:rounded-2xl md:shadow-2xl">

        <!-- Main flex container for the 5 sections -->
        <div class="flex flex-col h-full w-full">

            <!-- 1. Slim Top Section: Status Bar -->
            <header class="flex-shrink-0 h-16 bg-slate-800 px-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-1">
                    <span class="text-2xl">ü™ô</span>
                    <span class="font-bold text-base sm:text-lg">125</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="text-2xl">üåø</span>
                    <span class="font-bold text-base sm:text-lg">99</span>
                </div>
                 <div class="flex items-center gap-1">
                    <span class="text-2xl">üîÆ</span>
                    <span class="font-bold text-base sm:text-lg">42</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="text-2xl">‚ú®</span>
                    <span class="font-bold text-base sm:text-lg text-yellow-300">03</span>
                </div>
            </header>

            <!-- New Slim Meters Section -->
            <div class="flex-shrink-0 bg-slate-800 px-4 pb-3 space-y-2 border-t border-black/20">
                <div class="w-full bg-black/30 rounded-full h-2">
                    <div class="bg-red-500 h-2 rounded-full" style="width: 85%"></div>
                </div>
                <div class="w-full bg-black/30 rounded-full h-2">
                    <div class="bg-purple-500 h-2 rounded-full" style="width: 60%"></div>
                </div>
            </div>

            <!-- 2. Larger Central Section 1: Main Game View (now larger) -->
            <main class="flex-1 flex items-center justify-between p-4 bg-slate-700">
                <!-- Character on the left -->
                <div class="flex flex-col items-center">
                    <span class="text-8xl">üë§</span>
                    <div class="w-20 h-2 bg-blue-500 rounded-full mt-2 border-2 border-black/30"></div>
                </div>
                <!-- Enemies on the right -->
                <div class="flex flex-col gap-8">
                    <div class="flex flex-col items-center">
                        <span class="text-6xl">üê∫</span>
                        <div class="w-16 h-2 bg-red-500 rounded-full mt-2 border-2 border-black/30"></div>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-6xl">üêä</span>
                        <div class="w-16 h-2 bg-red-500 rounded-full mt-2 border-2 border-black/30"></div>
                    </div>
                </div>
            </main>

            <!-- 3. Larger Central Section 2: Character/Info View with Slot Machine and Upgrades -->
            <section class="flex-1 bg-purple-800 p-4 flex flex-col items-center justify-start pt-6 backdrop-blur-sm space-y-4">
                <div class="relative w-full max-w-xs flex justify-center items-center h-16">
                    <div id="spins-remaining-container" class="absolute left-0 text-white text-center opacity-0 transition-opacity duration-300">
                        <div id="spins-remaining-count" class="font-bold text-3xl leading-none">5</div>
                        <div class="text-xs uppercase tracking-wider">Spins</div>
                    </div>
                    <div id="slot-machine-container" class="flex gap-2 sm:gap-3 transition-all duration-300 rounded-lg">
                        <div id="reel1" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span>üíé</span></div>
                        <div id="reel2" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span>üëë</span></div>
                        <div id="reel3" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl border-2 border-transparent"><span>üêâ</span></div>
                    </div>
                </div>
                 <!-- Upgrade List -->
                <div id="upgrade-list" class="w-full max-w-xs text-gray-300 text-xs grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="flex items-center">
                        <span class="text-base mr-2">‚ö°Ô∏è</span>
                        <span>Faster Animation</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">üçÄ</span>
                        <span>Increased Luck</span>
                    </div>
                    <div class="flex items-center">
                        <span class-="text-base mr-2">üíé</span>
                        <span>Higher Payouts</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">üí∞</span>
                        <span>Bonus Gold</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">üîÑ</span>
                        <span>Free Re-spin</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">üêâ</span>
                        <span>Legendary Symbol</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">üìà</span>
                        <span>XP Boost on Win</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-base mr-2">‚ù§Ô∏è</span>
                        <span>Extra Life Chance</span>
                    </div>
                </div>
            </section>

            <!-- 4. Slim Bottom Section: Navigation -->
            <footer class="flex-shrink-0 h-24 bg-slate-900 p-3 flex justify-around items-center">
                <a href="#" class="flex-1 text-gray-400 hover:text-white transition-colors flex flex-col items-center justify-center">
                    <div class="w-8 h-8 bg-gray-600 rounded"></div>
                </a>
                <a href="#" id="spin-button" class="flex-1 text-white flex flex-col items-center cursor-pointer">
                    <div class="w-20 h-20 rounded-full bg-purple-600 flex items-center justify-center transition-transform duration-100 ease-in-out active:scale-90">
                    </div>
                </a>
                <a href="#" class="flex-1 text-gray-400 hover:text-white transition-colors flex flex-col items-center justify-center">
                    <div class="w-8 h-8 bg-gray-600 rounded"></div>
                </a>
            </footer>

            <!-- 5. Smaller Section Below: Reworked Item Slots -->
            <section class="flex-shrink-0 h-20 bg-slate-800 p-3 grid grid-cols-3 gap-3 items-center">
                <div id="item-slot-container-1" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="text-sm font-bold opacity-80">üü° 3</span>
                    <span id="item-slot-1" class="text-3xl opacity-80"></span>
                    <span class="text-sm font-bold opacity-80">+1</span>
                </div>
                <div id="item-slot-container-2" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="text-sm font-bold opacity-80">üü° 3</span>
                    <span id="item-slot-2" class="text-3xl opacity-80"></span>
                    <span class="text-sm font-bold opacity-80">+1</span>
                </div>
                <div id="item-slot-container-3" class="h-14 bg-black/40 rounded-lg flex items-center justify-center gap-1 shadow-inner border-2 border-black/30 text-white cursor-pointer transition-all">
                    <span class="text-sm font-bold opacity-80">üü° 3</span>
                    <span id="item-slot-3" class="text-3xl opacity-80"></span>
                    <span class="text-sm font-bold opacity-80">+1</span>
                </div>
            </section>

        </div>
    </div>

    <script>
        const spinButton = document.getElementById('spin-button');
        const reelElements = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const itemSlotSpans = [
            document.getElementById('item-slot-1'),
            document.getElementById('item-slot-2'),
            document.getElementById('item-slot-3')
        ];
        const itemSlotContainers = [
            document.getElementById('item-slot-container-1'),
            document.getElementById('item-slot-container-2'),
            document.getElementById('item-slot-container-3')
        ];
        const slotMachineContainer = document.getElementById('slot-machine-container');
        const spinsRemainingContainer = document.getElementById('spins-remaining-container');
        const spinsRemainingCount = document.getElementById('spins-remaining-count');

        // Define emoji categories
        const items = ['üîë', 'üó∫Ô∏è', '‚öóÔ∏è', 'üìú'];
        const equipment = ['üõ°Ô∏è', 'üëë', 'üíç', 'üë¢'];
        const food = ['üçé', 'ü•ï', 'üçó', 'üçû'];
        const weapons = ['‚öîÔ∏è', 'üèπ', 'ü™ì', 'ü™Ñ'];

        // Combine all emojis into one pool for the slot machine
        const emojis = [...items, ...equipment, ...food, ...weapons];

        let isSpinning = false; // Tracks if the 5-spin sequence is active
        let lockedSlotIndex = 0; // 0, 1, or 2. Starts with the first slot locked.

        // Function to set random emojis in the bottom slots
        function setRandomItemSlots() {
            // Create a shuffled copy of the emojis array to avoid duplicates
            const shuffledEmojis = [...emojis].sort(() => 0.5 - Math.random());

            itemSlotSpans.forEach((span, index) => {
                span.textContent = shuffledEmojis[index];
            });
        }
        
        // Function to update the visual lock on an item slot
        function setLockedSlot(index) {
            if (isSpinning) return; // Cannot change lock while spinning

            // Remove lock style from all slots
            itemSlotContainers.forEach(container => container.classList.remove('locked-slot'));
            
            // Add lock style to the selected slot and update state
            if (itemSlotContainers[index]) {
                itemSlotContainers[index].classList.add('locked-slot');
                lockedSlotIndex = index;
            }
        }

        // Helper function to shuffle a single reel's symbol
        function shuffleReel(reelSpan, duration) {
            return new Promise(resolve => {
                reelSpan.classList.remove('symbol-animate');
                reelSpan.style.opacity = '1'; // Make it visible for shuffling effect

                const shuffleInterval = setInterval(() => {
                    // Rapidly change the emoji to create a blur/shuffle effect
                    reelSpan.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                }, 50);

                setTimeout(() => {
                    clearInterval(shuffleInterval);
                    // Set the final emoji
                    reelSpan.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    // Apply the fade-in animation to the final symbol
                    reelSpan.classList.add('symbol-animate');
                    resolve();
                }, duration);
            });
        }

        // This function performs a single, full spin animation across all three reels
        async function runSingleSpinAnimation() {
             return new Promise(async (resolve) => {
                slotMachineContainer.classList.remove('winner');
                const spans = reelElements.map(reel => reel.querySelector('span'));

                // Reset animation classes from previous spins
                spans.forEach(span => {
                    span.classList.remove('symbol-animate');
                    span.style.opacity = '0'; // Hide symbols initially
                });

                // Sequentially shuffle each reel with shorter, quicker durations
                await shuffleReel(spans[0], 400);
                await shuffleReel(spans[1], 600);
                await shuffleReel(spans[2], 800);

                // Wait a moment for the last animation to be visible before checking win
                setTimeout(async () => {
                    const isCategoryWin = checkWin();

                    if (isCategoryWin) {
                        // Trigger the pulse/glow animation
                        slotMachineContainer.classList.add('category-win-animation');
                        // Wait for the longer animation to finish
                        await new Promise(res => setTimeout(res, 2000));
                        // Remove the animation class so it can run again
                        slotMachineContainer.classList.remove('category-win-animation');
                    }
                    resolve(); // Signal that this spin is complete
                }, 300);
            });
        }

        // This function handles the sequence of 5 spins.
        async function startFiveSpins() {
            if (isSpinning) return;
            isSpinning = true;

            spinsRemainingContainer.classList.remove('opacity-0');
            let spinsLeft = 5;
            spinsRemainingCount.textContent = spinsLeft;

            for (let i = 0; i < 5; i++) {
                await runSingleSpinAnimation();
                spinsLeft--;
                spinsRemainingCount.textContent = spinsLeft;

                if (i < 4) {
                    await new Promise(res => setTimeout(res, 250));
                }
            }

            setTimeout(() => {
                 spinsRemainingContainer.classList.add('opacity-0');
            }, 1000);

            isSpinning = false;
        }

        function checkWin() {
            const reel1Emoji = reelElements[0].querySelector('span').textContent;
            const reel2Emoji = reelElements[1].querySelector('span').textContent;
            const reel3Emoji = reelElements[2].querySelector('span').textContent;
            const allReels = [reel1Emoji, reel2Emoji, reel3Emoji];

            const categories = [items, equipment, food, weapons];
            let isCategoryWin = false;

            // Check for a standard win (three of the same symbol)
            if (reel1Emoji === reel2Emoji && reel2Emoji === reel3Emoji) {
                slotMachineContainer.classList.add('winner');
            }

            // Check for a "category" win (all three symbols from the same category)
            for (const category of categories) {
                if (allReels.every(emoji => category.includes(emoji))) {
                    const winningEmojis = [reel1Emoji, reel2Emoji, reel3Emoji];
                    let emojiIndex = 0;

                    // Update inventory, skipping the locked slot
                    for (let i = 0; i < itemSlotSpans.length; i++) {
                        if (i !== lockedSlotIndex) {
                            itemSlotSpans[i].textContent = winningEmojis[emojiIndex];
                            emojiIndex++;
                        }
                    }

                    isCategoryWin = true;
                    console.log("Category win!");
                    break;
                }
            }
            return isCategoryWin;
        }

        spinButton.addEventListener('click', startFiveSpins);
        
        itemSlotContainers.forEach((container, index) => {
            container.addEventListener('click', () => setLockedSlot(index));
        });

        // Initialize the bottom item slots when the script loads
        setRandomItemSlots();
        setLockedSlot(0); // Set initial lock on the first slot

    </script>
</body>
</html>

